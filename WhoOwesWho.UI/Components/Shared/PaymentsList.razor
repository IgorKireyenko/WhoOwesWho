@using WhoOwesWho.Common.Groups.Dto

<div class="payments-list-container">
<div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="section-title mb-0">Payments</h3>
    @if (OnAddPayment.HasDelegate)
    {
        <button class="btn btn-primary btn-sm" @onclick="OnAddPayment">
            <i class="bi bi-plus-circle"></i> Add payment
        </button>
    }
</div>
@if (Payments is null || Payments.Count == 0)
    {
        <div class="alert alert-info" role="alert">
            <p class="mb-0">No payments recorded yet.</p>
        </div>
    }
    else
    {
        <div class="payments-list">
            @foreach (var payment in Payments)
            {
                <div class="payment-card">
                    <div class="payment-header">
                        <span class="payment-member">@payment.MemberName</span>
                        <span class="payment-amount">@payment.Amount.ToString("C2")</span>
                    </div>
                    <div class="payment-details">
                        <div class="payment-date">
                            <i class="bi bi-calendar3"></i>
                            <span>@payment.PaymentDate.ToString("MM/dd/yyyy")</span>
                        </div>
                        @if (!string.IsNullOrWhiteSpace(payment.Description))
                        {
                            <div class="payment-description">
                                <i class="bi bi-file-text"></i>
                                <span>@payment.Description</span>
                            </div>
                        }
                    </div>
                    @if (OnRemovePayment.HasDelegate)
                    {
                        <div class="payment-actions mt-3">
                            <button class="btn btn-sm btn-outline-danger" @onclick="() => ShowRemoveConfirmation(payment)">
                                <i class="bi bi-trash"></i> Remove
                            </button>
                        </div>
                    }
                </div>
            }
        </div>
    }
</div>

<ConfirmationModal @ref="confirmationModal" 
                   Title="Remove Payment" 
                   Message="Are you really sure you want to remove this item?" 
                   OnConfirm="HandleRemovePaymentAsync" />

@code {
    [Parameter, EditorRequired]
    public required List<PaymentDto> Payments { get; set; }

    [Parameter]
    public EventCallback OnAddPayment { get; set; }

    [Parameter]
    public EventCallback<Guid> OnRemovePayment { get; set; }

    private ConfirmationModal? confirmationModal;
    private Guid paymentToRemove;

    private void ShowRemoveConfirmation(PaymentDto payment)
    {
        paymentToRemove = payment.Id;
        confirmationModal?.Show();
    }

    private async Task HandleRemovePaymentAsync()
    {
        if (OnRemovePayment.HasDelegate)
        {
            await OnRemovePayment.InvokeAsync(paymentToRemove);
        }
    }
}
